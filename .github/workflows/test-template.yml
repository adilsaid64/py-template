name: Validate Cookiecutter Template

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  render-template:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout template repository
        uses: actions/checkout@v4

      - name: Install Cookiecutter
        run: pip install cookiecutter

      - name: Generate project from template
        run: cookiecutter . --no-input

      - name: Verify generated project
        run: |
          PROJECT_DIR="My Python Project"

          echo "Checking that '$PROJECT_DIR' exists..."
          if [ ! -d "$PROJECT_DIR" ]; then
            echo "❌ ERROR: Expected project directory '$PROJECT_DIR' was NOT created."
            exit 1
          fi

          echo "Checking for expected files..."

          REQUIRED_FILES=(
            "$PROJECT_DIR/pyproject.toml"
            "$PROJECT_DIR/README.md"
            "$PROJECT_DIR/src"
            "$PROJECT_DIR/.github/workflows"
          )

          for FILE in "${REQUIRED_FILES[@]}"; do
            if [ ! -e "$FILE" ]; then
              echo "❌ ERROR: Missing expected file or folder: $FILE"
              exit 1
            fi
          done

          echo ""
          echo "✅ Template rendered correctly and key files exist."
